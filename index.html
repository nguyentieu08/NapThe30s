<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nguyễn Tiêu AI - Stable v1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0c0c0e;
            color: #f4f4f5;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            margin: 0;
            overflow: hidden;
        }

        .header-blur {
            background: rgba(12, 12, 14, 0.85);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #27272a;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 85%;
            padding: 0.9rem 1.1rem;
            border-radius: 1.2rem;
            font-size: 0.95rem;
            line-height: 1.6;
            animation: messagePop 0.3s ease-out;
            word-wrap: break-word;
        }

        @keyframes messagePop {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .user-message {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }

        .ai-message {
            background: #1c1c21;
            border: 1px solid #2d2d33;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .input-box {
            background: #0c0c0e;
            border-top: 1px solid #27272a;
            padding: 1rem 1.25rem;
            padding-bottom: calc(1rem + env(safe-area-inset-bottom));
        }

        .input-inner {
            background: #18181b;
            border: 1px solid #3f3f46;
            border-radius: 1.25rem;
            display: flex;
            align-items: center;
            padding: 0.3rem 0.5rem 0.3rem 1.2rem;
            max-width: 48rem;
            margin: 0 auto;
            transition: border-color 0.2s;
        }

        .input-inner:focus-within {
            border-color: #3b82f6;
        }

        input {
            background: transparent;
            border: none;
            color: white;
            flex: 1;
            outline: none;
            padding: 0.6rem 0;
            font-size: 16px;
        }

        .loading-dots {
            display: flex;
            gap: 4px;
            padding: 8px 0;
        }

        .dot {
            width: 5px; height: 5px;
            background: #60a5fa;
            border-radius: 50%;
            animation: dotWave 1.4s infinite ease-in-out;
        }

        @keyframes dotWave {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.3; }
            30% { transform: translateY(-6px); opacity: 1; }
        }

        pre {
            background: #000;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 8px 0;
            font-size: 0.85rem;
            border: 1px solid #333;
        }
        
        code { color: #93c5fd; }
    </style>
</head>
<body>

    <header class="header-blur p-4 sticky top-0 z-50 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center shadow-lg shadow-blue-500/20">
                <i class="fa-solid fa-microchip text-white text-lg"></i>
            </div>
            <div>
                <h1 class="font-bold text-sm tracking-tight">Nguyễn Tiêu <span class="text-blue-500">AI Pro v1.0</span></h1>
                <div class="flex items-center gap-1.5">
                    <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Hệ thống ổn định</span>
                </div>
            </div>
        </div>
        <button onclick="clearHistory()" class="text-zinc-500 hover:text-white p-2">
            <i class="fa-solid fa-trash-can"></i>
        </button>
    </header>

    <main id="chat-viewport" class="chat-area">
        <div id="welcome-screen" class="my-auto text-center px-6">
            <div class="w-20 h-20 bg-blue-500/10 border border-blue-500/20 rounded-[2.5rem] flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-sparkles text-blue-500 text-3xl"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">Chào bạn!</h2>
            <p class="text-zinc-500 text-sm max-w-[280px] mx-auto leading-relaxed">
                Hãy bắt đầu cuộc trò chuyện ngay!
            </p>
        </div>
        <div id="message-container" class="flex flex-col gap-4"></div>
    </main>

    <footer class="input-box">
        <div class="input-inner">
            <input id="user-input" type="text" placeholder="Hỏi tôi bất cứ điều gì..." autocomplete="off">
            <button id="send-btn" class="w-10 h-10 rounded-lg flex items-center justify-center text-blue-500 hover:bg-blue-500/10 transition-colors">
                <i class="fa-solid fa-paper-plane text-lg"></i>
            </button>
        </div>
        <div class="mt-4 flex flex-col items-center gap-1">
            <p class="text-[9px] text-zinc-600 font-bold uppercase tracking-[0.2em]">Nguyễn Tiêu AI • Nguyễn Tiêu Dev</p>
        </div>
    </footer>

    <script>
        const apiKey = ""; // Tự động nhận diện Key từ môi trường
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        const input = document.getElementById('user-input');
        const btn = document.getElementById('send-btn');
        const container = document.getElementById('message-container');
        const viewport = document.getElementById('chat-viewport');
        const welcome = document.getElementById('welcome-screen');

        let isWaiting = false;

        async function chat() {
            const prompt = input.value.trim();
            if (!prompt || isWaiting) return;

            isWaiting = true;
            welcome.style.display = 'none';
            addMessage('user', prompt);
            input.value = '';

            const aiId = 'ai-' + Date.now();
            addMessage('ai', `<div class="loading-dots"><div class="dot"></div><div class="dot" style="animation-delay:0.2s"></div><div class="dot" style="animation-delay:0.4s"></div></div>`, aiId);
            scrollToBottom();

            try {
                const response = await fetchWithRetry(prompt);
                const aiBubble = document.getElementById(aiId);
                aiBubble.innerHTML = formatResponse(response);
            } catch (err) {
                document.getElementById(aiId).innerHTML = `<span class="text-red-400"><i class="fa-solid fa-circle-exclamation mr-1"></i> Lỗi kết nối máy chủ. Hãy thử lại!</span>`;
            } finally {
                isWaiting = false;
                scrollToBottom();
            }
        }

        async function fetchWithRetry(prompt, retries = 3) {
            for (let i = 0; i < retries; i++) {
                try {
                    const res = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: "Bạn là trợ lý AI cao cấp của Nguyễn Tiêu. Trả lời bằng tiếng Việt, thông minh, không được lặp lại câu hỏi của người dùng. Hãy đưa ra các câu trả lời chi tiết và hữu ích." }] }
                        })
                    });
                    
                    if (!res.ok) throw new Error();
                    const data = await res.json();
                    return data.candidates[0].content.parts[0].text;
                } catch (e) {
                    if (i === retries - 1) throw e;
                    await new Promise(r => setTimeout(r, 1000));
                }
            }
        }

        function addMessage(role, content, id = '') {
            const div = document.createElement('div');
            div.className = `message ${role === 'user' ? 'user-message' : 'ai-message'}`;
            if (id) div.id = id;
            div.innerHTML = content;
            container.appendChild(div);
        }

        function formatResponse(text) {
            return text
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/\n/g, '<br>');
        }

        function scrollToBottom() {
            viewport.scrollTop = viewport.scrollHeight;
        }

        function clearHistory() {
            container.innerHTML = '';
            welcome.style.display = 'block';
        }

        btn.onclick = chat;
        input.onkeydown = (e) => { if (e.key === 'Enter') chat(); };
    </script>
</body>
</html>

